### 스프링은 다양한 스코프를 지원한다.

- 싱글톤 : 기본 스코프, 스프링 컨테이너의 시작과 종료까지 유지되는 가장 넓은 범위의 스코프
- 프로토타입 : 스프링 컨테이너는 프로토타입 빈의 생성과 의존관계 주입까지만 관여하고 더는 관리하지 않는 매우 짧은 범위의 스코프
- 웹 관련 스코프
	- request : 웹 요청이 들어오고 나갈때 까지 유지되는 스코프
	- session : 웹 세션이 생성되고 종료될 때 까지 유지되는 스코프
	- application : 웹의 서블릿 컨텍스트와 같은 범위로 유지되는 스코프

### 싱글톤 빈 요청

![[Pasted image 20221223190552.png]]

1. 싱글톤 스코프의 빈을 스프링 컨테이너에 요청
2. 스프링 컨테이너는 본인이 관리하는 스프링 빈을 반환
3. 이후에 스프링 컨테이너에 같은 요청이 와도 같은 객체 인스턴스의 스프링 빈을 반환

### 프로토타입 빈 요청

![[Pasted image 20221223190649.png]]

1. 프로토타입 스코프의 빈을 스프링 컨테이너에 요청
2. 스프링 컨테이너는 이 시점에 프로토타입 빈을 생성하고, 필요한 의존관계를 주입

![[Pasted image 20221223190735.png]]

3. 스프링 컨테이넌 생성한 프로토타입 빈을 클라이언트에 반환
4. 이후에 스프링 컨테이너에 같은 요청이 오면 항상 새로운 프로토타입 빈을 생성해서 반환


#### 프로토타입 빈의 특징
1. 스프링 컨테이너에 요청할 때 마다 새로 생성
2. 스프링 컨테이너는 프로토타입 빈의 생성과 의존관계 주입 그리고 초기화 까지만 관여
3. 종료 메서드가 호출되지 않음
4. 프로토타입 빈은 프로토타입 빈을 조회한 클라이언트가 관리해야 함. 종료메서드에 대한 호출도 클라이언트가 해야함.


## 프로토타입 스코프 - 싱글톤 빈과 함께 사용시 문제점

스프링 컨테이너에 프로토타입 스코프의 빈을 요청하면 항상 새로운 객체 인스턴스를 생성해서 반환한다.
하지만 싱글톤 빈과 함께 사용할 때는 의도한 대로 잘 동작하지 않으므로 주의.

![[Pasted image 20221223191200.png]]


#### 싱글톤에서 프로토타입 빈 사용

![[Pasted image 20221223191242.png]]

![[Pasted image 20221223191254.png]]

![[Pasted image 20221223191309.png]]

- 클라이언트 A와 B 가 clientBean을 스프링 컨테이너에 요청해서 받는다. 싱글톤이므로 항상 같은 clientBean이 반환된다.
- clientBean이 내부에 가지고 있는 프로토타입 빈은 이미 과거에 주입이 끝난 빈이다. ==주입 시점에 스프링 컨테이너에 요청해서 프로토타입 빈이 새로 생성이 된 것이지, 사용 할 때마다 새로 생성되는 것이 아니다.==

### 싱글톤 빈과 프로토타입 빈을 함께 사용할 때, 어떻게 하면 사용할 때 마다 새로운 프로토타입 빈을 생성할 수 있을까?

- 가장 간단한 방법은 싱글톤 빈이 프로토타입을 사용할 때 마다 스프링 컨테이너에 새로 요청하는 것

![[Pasted image 20221223191729.png]]

- 의존관계를 외부에서 주입(DI) 받는게 아니라 직접 필요한 의존관계를 찾는 것을 Dependency Lookup(DL) 의존관계 조회(탐색) 이라 한다.
- 이렇게 스프링의 애플리케이션 컨텍스트 전체를 주입받게 되면, 스프링 컨테이너에 종속적인 코드가 되고, 단위 테스트도 어려워진다.
- 지금 필요한 기능은 지정한 프로토타입 빈을 컨테이너에서 대신 찾아주는 DL 정도의 기능만 제공하는 무언가 있으면 됨


### ObjectFactory, ObjectProvider
- 지정한 빈을 컨테이너에서 대신 찾아주는 DL 서비스를 제공하는 것이 바로 bjectProvider 임.


### 자바 표준 Provider

![[Pasted image 20221223192627.png]]

- 실행해보면 `provider.get()` 을 통해서 항상 새로운 프로토타입 빈이 생성되는 것을 확인할 수 있음
- `provider get` 을 호출하면 내부에서 스프링 컨테이너를 통해 해당 빈을 찾아서 반환